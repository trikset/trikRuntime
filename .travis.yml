sudo: false

git:
  depth: 1

language: cpp
compiler: gcc

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - ubuntu-sdk-team
     packages:
      - g++-5
      - qdbus
      - xbitmaps
      - xterm
      - xvfb
      - qmlscene
      - libqt4-dev
      - libqt4-script
      - libqt4-svg
      - qt4-qmake
      - tcl

env:
  - CONFIG=debug     VERA=false   SUFFIX=-d
  - CONFIG=release   VERA=false   SUFFIX=

before_install:
  - pip install --user codecov

install:
  - export CC=/usr/bin/gcc-5
  - export CXX=/usr/bin/g++-5
  - Xvfb :0 &
  - export DISPLAY=:0

script:
  - $CXX --version
  - qmake-qt4 --version
  - export QMAKE_FLAGS="QMAKE_CXX=$CXX QMAKE_LINK=$CXX QMAKE_LINK_SHLIB=$CXX"
  - if [ "$VERA" = "true" ]; then tclsh vera++/generatePaths.tcl; fi
  - if [ "$VERA" = "true" ]; then vera++ --error -p allRules --root vera++ <vera++/params; fi
  - qmake-qt4 -r $QMAKE_FLAGS trikRuntime.pro CONFIG+=$CONFIG
  - make -j2
  - cd tests
  - qmake-qt4 -r $QMAKE_FLAGS CONFIG+=$CONFIG tests.pro
  - make -j2
  - cd minimalCppApp
  - qmake-qt4 -r $QMAKE_FLAGS CONFIG+=$CONFIG minimalCppApp.pro
  - make -j2
  - cd ../../bin/x86-$CONFIG
  - ls -A
  - sh -c "./trikScriptRunnerTests-x86$SUFFIX"
  - sh -c "./trikCommunicatorTests-x86$SUFFIX"
  - sh -c "./trikKernelTests-x86$SUFFIX"
  - cd ../..

after_success:
  - if [ "$CONFIG" = "debug" ]; then codecov --gcov-exec gcov-5; fi
